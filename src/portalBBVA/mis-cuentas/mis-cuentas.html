<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../shared/shared-styles.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html" />
<link rel="import" href="../../../bower_components/iron-list/iron-list.html" />
<link rel="import" href="../../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="../mis-movimientos/mis-movimientos.html" />

<dom-module id="mis-cuentas">
  <template>
    <style include="shared-styles">
    :host {
      display: block;

      padding: 10px;
    }
    </style>

    <app-localstorage-document key="data.local" data="{{islog}}"></app-localstorage-document>
    <div class="card">
      <h1>Mis cuentas</h1>

      <iron-list items="[[response]]" as="item">
        <template>
          <div id="t{{item.idAccount}}">
            <h2>{{item.nameAccount}} {{item.nroAccount}}</h2>
            <h3>saldo : {{item.saldo}}</h3>
            <h4><button on-click="mostrarMovimientosComponent" data-item$ ="[[index]]" > Ver movimientos</button></h4>
            <div hidden$="[[oculto]]" id="mov{{item.idAccount}}">
              <mis-movimientos api=[[api]] user=[[user]] account=[[account]] is_mov={{is_mov}}></mis-movimientos>
            </div>
          </div>
        </template>
      </iron-list>

    <iron-ajax
      auto
      id="getAccount"
      method="GET"
      url='[[api.api_host]][[api.api_users]]/[[islog.userID]]/[[api.api_accounts]]'
      handle-as="json"
      on-response="showData"
      headers$='{"authorization": "{{islog.token}}"}'>
  </template>

  <script>

    class MisCuentas extends Polymer.Element {
      static get is() {
        //console.log('logt'+this.islog);
        //this.user.userID = this.islog.userID;
        return 'mis-cuentas'; }
      static get properties() {
        return {
          oculto: {
            type: Boolean,
            value: true
          },
          user: {
            type: Object,
            value:{}
          },
          is_mov: {
            type: String,
            value:"NOK"
          },
          api: {
            type: Object
          },
          account: {
            type: Object,
            value: {}
          },
          is_account: {
            type: String,
            notify: true
          },
          islog: {
           type: Object,
           value: {}
          }
        };
      }

      showData(data) {
          //console.log(data.detail.response);
          //this.accounts = data.detail.response;
          this.response = data.detail.response[0].account;
          //this.id = data.detail.response[0].first_name;
          //this.name = data.detail.response[0].userID;
      }

      mostrarMovimientosComponent(){
        var item = Number(event.target.dataset.item)+1;
        let s = Polymer.dom(this.root).querySelector("#mov"+item);

        if(s.style.display == "none"){
          s.style.display = "block";
        }
        else if(s.style.display == "block"){
          s.style.display = "none";
        }
        else {
          s.style.display = "block";
        }
      }
    }

    window.customElements.define(MisCuentas.is, MisCuentas);
  </script>
</dom-module>
